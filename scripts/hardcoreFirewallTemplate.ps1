# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rules are provided by crazy-max/WindowsSpyBlocker
# https://github.com/crazy-max/WindowsSpyBlocker/tree/master/data/firewall
# Last updated on 4 Apr, 2020
# Template was adapted for SharpApp https://github.com/mirinsoft/sharpapp
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
########## Block Microsoft Telemetry IPs via Windows Firewall (Hardcore) ########## 
# This script will block third party applications from Microsoft like OneDrive, Skype, Live etc. and Windows Updates and Microsoft Store
Write-Output "Adding third party IPs to firewall"
Write-Output "Adding Windows update IPs to firewall"
$ips = @(
    "13.64.186.225"
    "13.76.218.117"
    "13.76.219.191"
    "13.76.219.210"
    "13.77.112.132"
    "13.77.115.36"
    "13.78.235.126"
    "13.78.235.247"
    "13.79.239.69"
    "13.79.239.82"
    "13.80.7.77"
    "13.80.12.54"
    "13.81.5.53"
    "13.83.98.37"
    "13.86.252.235"
    "13.88.145.128"
    "13.107.3.128"
    "13.107.3.254"
    "13.107.5.80"
    "13.107.5.88"
    "13.107.6.156"
    "13.107.6.158"
    "13.107.6.254"
    "13.107.13.88"
    "13.107.18.11"
    "13.107.18.254"
    "13.107.21.200"
    "13.107.21.229"
    "13.107.42.11"
    "13.107.42.12"
    "13.107.42.13"
    "13.107.42.14"
    "13.107.42.254"
    "13.107.43.12"
    "13.107.46.88"
    "13.107.47.88"
    "13.107.49.254"
    "13.107.128.254"
    "13.107.136.254"
    "13.107.255.72"
    "13.107.255.73"
    "13.107.255.74"
    "13.107.255.76"
    "20.43.92.14"
    "20.46.146.84"
    "20.150.29.228"
    "20.190.137.98"
    "20.188.76.57"
    "23.96.52.53"
    "23.96.208.208"
    "23.97.61.137"
    "23.97.178.173"
    "23.97.209.97"
    "23.99.109.44"
    "23.99.109.64"
    "23.99.116.116"
    "23.99.121.207"
    "23.100.122.175"
    "23.101.156.198"
    "23.101.158.111"
    "23.102.47.40"
    "40.67.249.61"
    "40.69.176.16"
    "40.70.0.108"
    "40.70.158.26"
    "40.74.35.71"
    "40.74.70.63"
    "40.77.225.248"
    "40.77.230.45"
    "40.79.48.16"
    "40.79.138.41"
    "40.80.145.78"
    "40.81.94.65"
    "40.81.188.85"
    "40.83.74.46"
    "40.83.127.51"
    "40.83.150.233"
    "40.85.78.63"
    "40.85.83.182"
    "40.89.135.48"
    "40.90.22.183"
    "40.90.22.184"
    "40.90.22.185"
    "40.90.22.186"
    "40.90.22.187"
    "40.90.22.188"
    "40.90.22.189"
    "40.90.22.190"
    "40.90.22.191"
    "40.90.22.192"
    "40.90.22.198"
    "40.90.23.0-40.90.23.255"
    "40.90.136.1"
    "40.90.136.3"
    "40.90.136.19"
    "40.90.136.20"
    "40.90.136.163"
    "40.90.136.166"
    "40.90.136.180"
    "40.90.137.120"
    "40.90.137.122"
    "40.90.137.124"
    "40.90.137.125"
    "40.90.137.126"
    "40.90.137.127"
    "40.90.190.179"
    "40.90.218.0"
    "40.91.76.238"
    "40.91.78.9"
    "40.97.161.50"
    "40.101.4.2"
    "40.101.12.130"
    "40.101.18.242"
    "40.101.19.146"
    "40.101.46.178"
    "40.101.80.178"
    "40.101.83.18"
    "40.101.124.34"
    "40.101.124.194"
    "40.101.128.178"
    "40.101.136.2"
    "40.101.137.2"
    "40.101.137.18"
    "40.101.137.66"
    "40.101.138.2"
    "40.101.138.18"
    "40.102.34.194"
    "40.112.72.44"
    "40.112.75.175"
    "40.112.90.122"
    "40.112.91.29"
    "40.113.0.16"
    "40.113.97.222"
    "40.114.54.223"
    "40.114.140.1"
    "40.114.224.200"
    "40.114.241.141"
    "40.115.33.128"
    "40.117.96.136"
    "40.117.190.72"
    "40.118.61.1"
    "40.118.103.7"
    "40.118.106.130"
    "40.119.6.179"
    "40.121.213.159"
    "40.122.160.14"
    "40.126.1.166"
    "40.126.9.5"
    "40.127.128.174"
    "40.127.142.76"
    "40.127.195.156"
    "51.105.208.173"
    "51.137.137.111"
    "51.136.15.177"
    "51.136.37.147"
    "51.140.65.84"
    "51.140.98.69"
    "51.140.127.197"
    "51.141.26.229"
    "51.141.32.51"
    "51.141.166.104"
    "52.142.84.61"
    "51.144.108.120"
    "51.145.123.29"
    "52.97.135.114"
    "52.97.146.34"
    "52.97.150.2"
    "52.97.151.50"
    "52.97.151.82"
    "52.97.152.114"
    "52.97.155.114"
    "52.97.171.194"
    "52.97.186.114"
    "52.97.189.98"
    "52.97.232.194"
    "52.98.66.98"
    "52.109.8.19"
    "52.109.8.20"
    "52.109.8.21"
    "52.109.12.18"
    "52.109.12.19"
    "52.109.12.20"
    "52.109.12.21"
    "52.109.12.22"
    "52.109.12.23"
    "52.109.12.24"
    "52.109.76.30"
    "52.109.76.31"
    "52.109.76.32"
    "52.109.76.33"
    "52.109.76.34"
    "52.109.76.35"
    "52.109.76.36"
    "52.109.76.40"
    "52.109.88.6"
    "52.109.88.34"
    "52.109.88.35"
    "52.109.88.36"
    "52.109.88.37"
    "52.109.88.38"
    "52.109.88.39"
    "52.109.88.40"
    "52.109.88.44"
    "52.109.120.17"
    "52.109.120.18"
    "52.109.120.19"
    "52.109.120.20"
    "52.109.120.21"
    "52.109.120.22"
    "52.109.120.23"
    "52.109.124.18"
    "52.109.124.19"
    "52.109.124.20"
    "52.109.124.21"
    "52.109.124.22"
    "52.109.124.23"
    "52.109.124.24"
    "52.113.194.131"
    "52.113.194.132"
    "52.136.230.174"
    "52.138.148.87"
    "52.138.148.89"
    "52.138.148.159"
    "52.142.80.173"
    "52.142.114.2"
    "52.142.114.176"
    "52.142.119.134"
    "52.156.41.171"
    "52.156.48.67"
    "52.156.196.151"
    "52.156.204.185"
    "52.158.24.209"
    "52.158.24.229"
    "52.158.25.39"
    "52.158.238.42"
    "52.163.118.68"
    "52.164.191.55"
    "52.164.227.208"
    "52.164.251.44"
    "52.166.110.64"
    "52.166.110.215"
    "52.166.120.77"
    "52.167.18.95"
    "52.167.88.112"
    "52.168.24.174"
    "52.169.71.150"
    "52.170.194.77"
    "52.171.136.200"
    "52.173.152.64"
    "52.175.30.196"
    "52.176.224.96"
    "52.178.161.41"
    "52.178.163.85"
    "52.178.193.116"
    "52.179.13.204"
    "52.183.104.36"
    "52.184.82.129"
    "52.184.92.48"
    "52.184.168.116"
    "52.188.77.27"
    "52.225.136.36"
    "52.230.10.183"
    "52.230.240.94"
    "52.232.16.77"
    "52.232.19.76"
    "52.232.69.150"
    "52.233.199.249"
    "52.239.137.4"
    "52.239.156.74"
    "52.239.156.138"
    "52.239.177.36"
    "52.239.177.100"
    "52.239.177.228"
    "52.239.150.170"
    "52.239.151.138"
    "52.239.151.170"
    "52.239.157.138"
    "52.239.157.202"
    "52.239.177.68"
    "52.239.184.10"
    "52.239.184.42"
    "52.239.207.100"
    "64.4.16.212"
    "64.4.16.214"
    "64.4.16.216"
    "64.4.16.218"
    "64.4.23.0-64.4.23.255"
    "64.4.54.18"
    "64.4.54.22"
    "64.4.54.253"
    "64.4.54.254"
    "65.52.98.231"
    "65.52.226.14"
    "65.54.187.128"
    "65.54.187.130"
    "65.54.187.131"
    "65.54.187.132"
    "65.54.187.134"
    "65.54.198.196"
    "65.55.108.23"
    "65.55.130.50"
    "65.55.223.0-65.55.223.255"
    "104.40.210.32"
    "104.40.211.35"
    "104.41.219.140"
    "104.42.41.237"
    "104.43.203.255"
    "104.44.80.172"
    "104.44.88.24"
    "104.44.88.28"
    "104.44.88.103"
    "104.45.18.177"
    "104.46.91.34"
    "104.208.248.16"
    "104.209.172.133"
    "104.211.96.15"
    "104.214.77.221"
    "104.214.150.122"
    "104.214.220.181"
    "104.215.146.200"
    "131.253.14.227"
    "131.253.14.229"
    "131.253.14.230"
    "131.253.14.231"
    "131.253.61.0-131.253.61.255"
    "134.170.178.97"
    "134.170.185.70"
    "134.170.188.248"
    "137.116.44.10"
    "137.116.234.82"
    "137.117.142.136"
    "137.117.144.39"
    "137.117.228.253"
    "137.117.235.16"
    "137.117.243.30"
    "137.135.251.63"
    "138.91.122.49"
    "157.55.56.0-157.55.56.255"
    "157.55.109.7"
    "157.55.109.224"
    "157.55.109.226"
    "157.55.109.228"
    "157.55.109.230"
    "157.55.109.232"
    "157.55.129.21"
    "157.55.134.136"
    "157.55.134.138"
    "157.55.134.140"
    "157.55.134.142"
    "157.55.135.128"
    "157.55.135.130"
    "157.55.135.132"
    "157.55.135.134"
    "157.56.57.5"
    "168.63.18.79"
    "168.63.102.42"
    "191.237.208.126"
    "191.239.213.197"
    "204.79.197.0-204.79.197.255"
    "204.152.141.244"
    "207.46.7.252"
    "207.46.26.12"
    "207.46.26.14"
    "207.46.26.16"
    "207.46.26.18"
    "207.46.101.29"
    "207.46.153.155"
    "207.46.194.14"
    "207.46.194.25"
    "207.46.194.33"
    "207.46.194.40"
    "207.46.223.94"
    # Adding Windows update IPs to firewall
    "13.68.87.47"
    "13.68.87.175"
    "13.68.88.129"
    "13.68.93.109"
    "13.74.179.117"
    "13.78.168.230"
    "13.78.177.144"
    "13.78.179.199"
    "13.78.180.50"
    "13.78.180.90"
    "13.78.184.44"
    "13.78.184.186"
    "13.78.186.254"
    "13.78.187.58"
    "13.78.230.134"
    "13.83.148.218"
    "13.83.148.235"
    "13.83.149.5"
    "13.83.149.67"
    "13.85.88.16"
    "13.86.124.174"
    "13.86.124.184"
    "13.86.124.191"
    "13.92.211.120"
    "13.107.4.50"
    "13.107.4.52"
    "13.107.4.254"
    "20.36.218.63"
    "20.36.218.70"
    "20.36.222.39"
    "20.36.252.129"
    "20.36.252.130"
    "20.41.41.23"
    "20.42.24.29"
    "20.42.24.50"
    "20.44.77.24"
    "20.44.77.45"
    "20.44.77.49"
    "20.44.77.219"
    "20.45.4.77"
    "20.45.4.178"
    "20.185.109.208"
    "20.186.48.46"
    "20.188.74.161"
    "20.188.78.184"
    "23.103.189.125"
    "23.103.189.126"
    "23.103.189.157"
    "23.103.189.158"
    "40.67.248.104"
    "40.67.251.132"
    "40.67.251.134"
    "40.67.252.206"
    "40.67.253.249"
    "40.67.254.36"
    "40.67.254.97"
    "40.67.255.199"
    "40.69.216.73"
    "40.69.216.129"
    "40.69.216.251"
    "40.69.218.62"
    "40.69.219.197"
    "40.69.220.46"
    "40.69.221.239"
    "40.69.222.109"
    "40.69.223.39"
    "40.69.223.198"
    "40.77.224.8"
    "40.77.224.11"
    "40.77.224.145"
    "40.77.224.254"
    "40.77.226.13"
    "40.77.226.181"
    "40.77.226.246"
    "40.77.226.247"
    "40.77.226.248"
    "40.77.226.249"
    "40.77.226.250"
    "40.77.229.8"
    "40.77.229.9"
    "40.77.229.12"
    "40.77.229.13"
    "40.77.229.16"
    "40.77.229.21"
    "40.77.229.22"
    "40.77.229.24"
    "40.77.229.26"
    "40.77.229.27"
    "40.77.229.29"
    "40.77.229.30"
    "40.77.229.32"
    "40.77.229.35"
    "40.77.229.38"
    "40.77.229.44"
    "40.77.229.45"
    "40.77.229.50"
    "40.77.229.53"
    "40.77.229.62"
    "40.77.229.65"
    "40.77.229.67"
    "40.77.229.69"
    "40.77.229.70"
    "40.77.229.71"
    "40.77.229.74"
    "40.77.229.76"
    "40.77.229.80"
    "40.77.229.81"
    "40.77.229.82"
    "40.77.229.88"
    "40.77.229.118"
    "40.77.229.123"
    "40.77.229.128"
    "40.77.229.133"
    "40.77.229.141"
    "40.77.229.199"
    "40.79.65.78"
    "40.79.65.123"
    "40.79.65.235"
    "40.79.65.237"
    "40.79.66.194"
    "40.79.66.209"
    "40.79.67.176"
    "40.79.70.158"
    "40.91.73.219"
    "40.91.75.5"
    "40.91.91.94"
    "40.91.120.196"
    "40.91.122.44"
    "51.105.249.223"
    "51.105.249.228"
    "51.105.249.239"
    "52.142.21.136"
    "52.147.176.8"
    "52.155.95.90"
    "52.155.115.56"
    "52.155.169.137"
    "52.155.183.99"
    "52.155.217.156"
    "52.155.223.194"
    "52.158.114.119"
    "52.158.122.14"
    "52.161.15.246"
    "52.164.221.179"
    "52.167.222.82"
    "52.167.222.147"
    "52.167.223.135"
    "52.169.82.131"
    "52.169.83.3"
    "52.169.87.42"
    "52.169.123.48"
    "52.175.23.79"
    "52.177.164.251"
    "52.178.192.146"
    "52.183.47.176"
    "52.183.118.171"
    "52.184.152.136"
    "52.184.155.206"
    "52.187.60.107"
    "52.188.72.233"
    "52.226.130.114"
    "52.229.170.171"
    "52.229.170.224"
    "52.229.171.86"
    "52.229.171.202"
    "52.229.172.155"
    "52.229.174.29"
    "52.229.174.172"
    "52.229.174.233"
    "52.229.175.79"
    "52.230.216.17"
    "52.230.216.157"
    "52.230.220.159"
    "52.230.223.92"
    "52.230.223.167"
    "52.232.225.93"
    "52.242.231.32"
    "52.248.96.36"
    "52.249.24.101"
    "52.249.58.51"
    "52.253.130.84"
    "52.254.106.61"
    "64.4.27.50"
    "65.52.108.29"
    "65.52.108.33"
    "65.52.108.59"
    "65.52.108.90"
    "65.52.108.92"
    "65.52.108.153"
    "65.52.108.154"
    "65.52.108.185"
    "65.55.138.0-65.55.138.255"
    "65.55.163.76"
    "65.55.163.78"
    "65.55.163.80"
    "65.55.163.82"
    "65.55.163.90"
    "65.55.163.91"
    "65.55.163.219"
    "65.55.163.220"
    "65.55.163.221"
    "65.55.163.222"
    "65.55.242.254"
    "66.119.144.157"
    "66.119.144.158"
    "66.119.144.189"
    "66.119.144.190"
    "104.45.177.233"
    "111.221.29.11"
    "111.221.29.40"
    "111.221.29.134"
    "111.221.29.253"
    "111.221.29.254"
    "131.253.33.50"
    "131.253.33.200"
    "131.253.33.203"
    "131.253.33.254"
    "131.253.34.230"
    "131.253.34.234"
    "131.253.34.237"
    "131.253.34.243"
    "131.253.34.246"
    "131.253.34.247"
    "131.253.34.249"
    "131.253.34.252"
    "131.253.34.255"
    "134.170.51.187"
    "134.170.51.188"
    "134.170.51.190"
    "134.170.51.246"
    "134.170.51.247"
    "134.170.51.248"
    "134.170.53.29"
    "134.170.53.30"
    "134.170.58.0-134.170.58.255"
    "134.170.115.55"
    "134.170.115.56"
    "134.170.115.60"
    "134.170.115.62"
    "134.170.165.248"
    "134.170.165.249"
    "134.170.165.251"
    "134.170.165.253"
    "137.135.62.92"
    "157.55.133.204"
    "157.55.240.89"
    "157.55.240.126"
    "157.55.240.220"
    "157.56.77.138"
    "157.56.77.139"
    "157.56.77.140"
    "157.56.77.141"
    "157.56.77.148"
    "157.56.77.149"
    "157.56.96.54"
    "157.56.96.58"
    "157.56.96.123"
    "157.56.96.157"
    "191.232.80.53"
    "191.232.80.58"
    "191.232.80.60"
    "191.232.80.62"
    "191.232.139.2"
    "191.232.139.182"
    "191.232.139.253"
    "191.232.139.254"
    "191.234.72.183"
    "191.234.72.186"
    "191.234.72.188"
    "191.234.72.190"
    "207.46.114.58"
    "207.46.114.61"
)
Remove-NetFirewallRule -DisplayName "SharpApp Microsoft Telemetry Block (Hardcore)" -ErrorAction SilentlyContinue
New-NetFirewallRule -DisplayName "SharpApp Microsoft Telemetry Block (Hardcore)" -Direction Outbound `
    -Action Block -RemoteAddress ([string[]]$ips)
